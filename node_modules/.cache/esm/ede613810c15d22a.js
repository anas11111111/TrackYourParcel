let winston,expressWinston,winstonFile,winstonMongo,ElasticsearchTransport,uri;_0c1‍.x([["infoLogger",()=>infoLogger],["errorLogger",()=>errorLogger]]);_0c1‍.w("winston",[["default",["winston"],function(v){winston=v}]]);_0c1‍.w("express-winston",[["default",["expressWinston"],function(v){expressWinston=v}]]);_0c1‍.w("winston-daily-rotate-file",[["default",["winstonFile"],function(v){winstonFile=v}]]);_0c1‍.w("winston-mongodb",[["default",["winstonMongo"],function(v){winstonMongo=v}]]);_0c1‍.w("winston-elasticsearch",[["ElasticsearchTransport",["ElasticsearchTransport"],function(v){ElasticsearchTransport=v}]]);_0c1‍.w("./mongo",[["uri",["uri"],function(v){uri=v}]]);






const getMessage = (req, res) => {
    let obj = {
        correlationId: req.headers['x-correlation-id'],
        requestBody: req.body
    };
    return JSON.stringify(obj);
}

const fileInfoTransport = new (winston.transports.DailyRotateFile)({
    filename: 'log-info-%DATE%.log',
    datePattern: 'yyyy-MM-DD-HH'
})
const elasticsearchOptions = {
    level: 'info',
    clientOpts: { node: 'http://localhost:9200' },
    indexPrefix: 'log-trackyourparcel',
};
const esTransport = new (ElasticsearchTransport)(elasticsearchOptions);
       const infoLogger =(uri)=> expressWinston.logger({
    transports: [
        new winston.transports.Console(),
        fileInfoTransport,
        esTransport
    ],
    format: winston.format.combine(winston.format.colorize(), winston.format.json()),
    meta: true,
    //msg: 'this is a log {{req.method}}'
    msg: getMessage
});

const fileErrorTransport = new (winston.transports.DailyRotateFile)({
    filename: 'error-info-%DATE%.log',
    datePattern: 'yyyy-MM-DD-HH'
});

const mongoErrorTransport = (uri)=>new winston.transports.MongoDB({
    db: uri,
    metaKey: 'meta',
})

       const errorLogger =(uri) => expressWinston.errorLogger({
    transports: [
        new winston.transports.Console(),
        fileErrorTransport, mongoErrorTransport(uri), esTransport,

    ],
    format: winston.format.combine(winston.format.colorize(), winston.format.json()),
    meta: true,
    msg: '{"correlationalId":"{{req.headers.x-correlation-id}}","error":"{{err.message}}"}'


});
